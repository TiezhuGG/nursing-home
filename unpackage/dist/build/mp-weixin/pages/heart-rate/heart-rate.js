(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/heart-rate/heart-rate"],{"071d":function(t,e,n){"use strict";var a,r=function(){var t=this,e=t.$createElement;t._self._c},i=[];n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return a}))},2010:function(t,e,n){"use strict";n.r(e);var a=n("071d"),r=n("9e62");for(var i in r)"default"!==i&&function(t){n.d(e,t,(function(){return r[t]}))}(i);n("97a1");var o,c=n("f0c5"),s=Object(c["a"])(r["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],o);e["default"]=s.exports},"61c9":function(t,e,n){},"97a1":function(t,e,n){"use strict";var a=n("61c9"),r=n.n(a);r.a},"9e62":function(t,e,n){"use strict";n.r(e);var a=n("ab3c"),r=n.n(a);for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e["default"]=r.a},ab3c:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,r=o(n("4795")),i=o(n("9591"));function o(t){return t&&t.__esModule?t:{default:t}}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e,n,a,r,i,o){try{var c=t[i](o),s=c.value}catch(u){return void n(u)}c.done?e(s):Promise.resolve(s).then(a,r)}function u(t){return function(){var e=this,n=arguments;return new Promise((function(a,r){var i=t.apply(e,n);function o(t){s(i,a,r,o,c,"next",t)}function c(t){s(i,a,r,o,c,"throw",t)}o(void 0)}))}}function l(t){return d(t)||f(t)||g(t)||h()}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function d(t){if(Array.isArray(t))return m(t)}function p(t){if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=g(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r,i=!0,o=!1;return{s:function(){a=t[Symbol.iterator]()},n:function(){var t=a.next();return i=t.done,t},e:function(t){o=!0,r=t},f:function(){try{i||null==a.return||a.return()}finally{if(o)throw r}}}}function g(t,e){if(t){if("string"===typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}var v=null,b=n("7063"),_={data:function(){var t=this.getDate({format:!0});return{time_range:["08:25","09:45","10:22","12:12","13:25","16:25","18:25"],dateList:[{date:"2020年2月19日",time:["09:55:16","10:25:26","09:55:16"]},{date:"2020年2月20日",time:["09:55:16","10:25:26","09:55:16","09:55:16"]}],bpm:"86BPM",showCharts:!1,cWidth:"",cHeight:"",pixelRatio:1,client:null,patientList:[],patient:null,heart_rate_list:[],categories:[],heart_rate:null,date:t,mac:"E21B0CF75104",highest_bpm:0,lowest_bpm:0,avg_bpm:0}},onLoad:function(e){a=this,e.pid&&(this.fetchPatientInfo(e.pid),this.getSocket()),this.fetchPatientList(),this.cWidth=t.upx2px(750),this.cHeight=t.upx2px(500)},onUnload:function(){this.client&&t.closeSocket({success:function(){console.log("断开websocket")}})},computed:{startDate:function(){return this.getDate("start")},endDate:function(){return this.getDate("end")}},watch:{patient:function(t,e){this.heart_rate_list=[],this.categories=[],a.showLineA("myChart"),null!=t&&v.updateData({categories:this.categories,series:[{name:"实时心率",data:this.heart_rate_list}]})},deep:!0},methods:{test:function(t){var e=this;this.showCharts=!0,this.fetchPatientInfo(t),setInterval((function(){var t=300*Math.random(),n=300*Math.random();e.heart_rate_list.push(t),e.categories.push(n),e.heart_rate_list.length>8&&(e.heart_rate_list.shift(),e.categories.shift()),v.updateData({categories:e.categories,series:[{name:"实时心率",data:a.heart_rate_list}]})}),1e3)},getSocket:function(){var t=this;this.showCharts=!0,null==this.client&&(this.client=b.connect("wxs://ciaiky.le-cx.com/mqtt",{clientId:this.randomString(),username:"admin",password:"admin"}),this.client.on("connect",(function(){console.log("mqtt连接成功"),t.client.subscribe("/statues",(function(e){e?console.log("订阅失败"):(console.log("订阅成功"),a.showLineA("myChart"),v.updateData({categories:t.categories,series:[{name:"实时心率",data:t.heart_rate_list}]}))}))}))),this.client.on("error",(function(t){console.log(t)})),this.client.on("message",(function(e,n){var a=n.toString(),r=JSON.parse(a);if(r.length>1){var i,o=p(r);try{for(o.s();!(i=o.n()).done;){var c=i.value;if(t.patient&&c.mac==t.patient.mac){t.heart_rate=parseInt(c.rawData.slice(26,28),16),console.log("心率",t.heart_rate);var s=c.timestamp.slice(12,19);t.heart_rate_list.push(t.heart_rate),t.categories.push(s),t.highest_bpm=Math.max.apply(Math,l(t.heart_rate_list)),t.lowest_bpm=Math.min.apply(Math,l(t.heart_rate_list)),t.avg_bpm=t.getAverage(t.heart_rate_list),t.drawChart()}}}catch(u){o.e(u)}finally{o.f()}}}))},drawChart:function(){var t=this;setInterval((function(){t.heart_rate_list.length>50&&(t.heart_rate_list.shift(),t.categories.shift()),v.updateData({categories:a.categories,series:[{name:"实时心率",data:a.heart_rate_list}]})}),1e3)},toChoice:function(){t.redirectTo({url:"../choicePatient/choicePatient"})},fetchPatientList:function(){var e=this;return u(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.request({url:"https://ciai.le-cx.com/index.php/api/patient/patientList",success:function(t){e.patientList=t.data.data}});case 2:case"end":return n.stop()}}),n)})))()},fetchPatientInfo:function(e){var n=this;return u(r.default.mark((function a(){return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.request({url:"https://ciai.le-cx.com/index.php/api/patient/info?id=".concat(e),success:function(t){n.patient=t.data.data}});case 2:case"end":return a.stop()}}),a)})))()},showLineA:function(t){var e;v=new i.default((e={$this:a,canvasId:t,colors:["#FFFFFF"],type:"line",fontSize:12,dataLabel:!1,dataPointShape:!0,background:"#24C789",pixelRatio:a.pixelRatio,categories:"",series:[{name:"实时心率",data:""}],animation:!1},c(e,"dataPointShape",!1),c(e,"xAxis",{gridColor:"#FFF",gridType:"dash",disableGrid:!0,axisLine:!1,fontColor:"#FFF",disabled:!0}),c(e,"yAxis",{data:[{position:"right",fontColor:"#FFF",axisLineColor:"#24C789",format:function(t){return t.toFixed(0)}}],gridType:"dash",gridColor:"#FFF",splitNumber:6,dashLength:2}),c(e,"width",a.cWidth*a.pixelRatio),c(e,"height",a.cHeight*a.pixelRatio),c(e,"extra",{line:{type:"straight"},tooltip:{gridType:"dash",dashLength:5,gridColor:"#24C789"}}),e))},touchLineA:function(t){v.showToolTip(t,{format:function(t,e){return e+" "+t.name+":"+t.data}})},randomString:function(t){t=t||32;for(var e="abcdefghijklmnopqrstuvwxyz0123456789",n=e.length,a="",r=0;r<t;r++)a+=e.charAt(Math.floor(Math.random()*n));return a},bindDateChange:function(t){this.date=t.target.value},getDate:function(t){var e=new Date,n=e.getFullYear(),a=e.getMonth()+1,r=e.getDate();return"start"===t?n-=60:"end"===t&&(n+=2),a=a>9?a:"0"+a,r=r>9?r:"0"+r,"".concat(n,"-").concat(a,"-").concat(r)},getAverage:function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return Math.ceil(e/t.length)}}};e.default=_}).call(this,n("543d")["default"])},b352:function(t,e,n){"use strict";(function(t){n("04ee"),n("921b");a(n("66fd"));var e=a(n("2010"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])}},[["b352","common/runtime","common/vendor"]]]);