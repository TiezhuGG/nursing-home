(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/blood-status/blood-status"],{"15ec":function(t,e,i){"use strict";var n=i("96b8"),a=i.n(n);a.a},"5dea":function(t,e,i){"use strict";i.r(e);var n=i("e4a1"),a=i("d6df");for(var o in a)"default"!==o&&function(t){i.d(e,t,(function(){return a[t]}))}(o);i("15ec");var r,s=i("f0c5"),u=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],r);e["default"]=u.exports},"96b8":function(t,e,i){},c9a0:function(t,e,i){"use strict";(function(t){i("04ee"),i("921b");n(i("66fd"));var e=n(i("5dea"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},d660:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,a=r(i("4795")),o=r(i("9591"));function r(t){return t&&t.__esModule?t:{default:t}}function s(t){if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=u(t))){var e=0,i=function(){};return{s:i,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a,o=!0,r=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){r=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(r)throw a}}}}function u(t,e){if(t){if("string"===typeof t)return c(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function d(t,e,i,n,a,o,r){try{var s=t[o](r),u=s.value}catch(c){return void i(c)}s.done?e(u):Promise.resolve(u).then(n,a)}function l(t){return function(){var e=this,i=arguments;return new Promise((function(n,a){var o=t.apply(e,i);function r(t){d(o,n,a,r,s,"next",t)}function s(t){d(o,n,a,r,s,"throw",t)}r(void 0)}))}}var h=null,p={data:function(){var t=this.getDate({format:!0});return{navTitles:["血压","血氧","血糖"],currentIndex:0,cWidth:"",cHeight:"",pixelRatio:1,patientList:[],patient:null,chart:1,pid:"",showCharts:!1,date:t,date2:t,start_time:null,end_time:null,timer:"",bp_devices:[],bp_connected:!1,bp_chs:[],bp_discoveryStarted:!1,bp_canWrite:!1,bp_deviceId:"",bp_serviceId:"",bp_characteristicId:"",bp_list:[],bp_categories:[],blood_pressure:null,high_blood_pressure:null,low_blood_pressure:null,pressure_pulse_rate:null,bo_devices:[],bo_connected:!1,bo_chs:[],bo_discoveryStarted:!1,bo_canWrite:!1,bo_deviceId:"",bo_serviceId:"",bo_characteristicId:"",bo_list:[],bo_categories:[],blood_oxygen:null,oxygen_pulse_rate:null}},onLoad:function(e){this.start_time=this.dateToTimestamp(this.date),this.end_time=this.start_time+864e5,e.bpid&&(console.log("从工作台进来",e.bpid),this.fetchPatientInfo(e.bpid),this.pid=e.bpid),e.patient_id&&(console.log("从客户管理界面进来",e.patient_id),this.fetchPatientInfo(e.patient_id),this.pid=e.patient_id),n=this,n.fetchPatientList(),this.cWidth=t.upx2px(750),this.cHeight=t.upx2px(500)},onHide:function(){this.showCharts=!1},computed:{startDate:function(){return this.getDate("start")},endDate:function(){return this.getDate("end")}},watch:{patient:function(t,e){null!=e&&t.id!=e.id&&(this.showCharts=!1)},deep:!0},methods:{test:function(t,e){var i=this;if(this.showCharts=!0,t){this.fetchPatientInfo(t);for(var a=0;a<e.length;a++)setTimeout((function(){var t=300*Math.random(),e=300*Math.random();i.bp_list.push(t),i.bp_categories.push(e),i.bp_list.length>8&&(i.bp_list.shift(),i.bp_categories.shift()),n.showLineA(i.chart),h.updateData({categories:n.bp_categories,series:[{name:"血压 血氧 血糖",data:n.bp_list}]})}),1e3*a)}},drawChart:function(t,e,i){if(this.showCharts=!0,this.bo_list=[],this.bo_categories=[],t){this.fetchPatientInfo(t);for(var a=0,o=[],r=[],s=0;s<e.length;s++)if("undefined"!==e[s].value&&"undefined"!==e[s].pulse_rate){var u=this.timestampToTime(parseInt(e[s].time)).substr(5,11);this.bo_categories.push(u),a+=parseInt(e[s].pulse_rate),"血氧"===i?(this.bo_list.push(e[s].value),parseInt(e[s].value)):"血压"===i?(o.push(JSON.parse(e[s].value).high_blood_pressure),r.push(JSON.parse(e[s].value).low_blood_pressure)):console.log("血糖")}0!=a&&"血压"==i&&(console.log("获取血压数据"),this.pressure_pulse_rate=(a/s).toFixed(0),this.bp_list=[{name:"高压",data:o},{name:"低压",data:r}],n.showLineA(this.chart,this.bo_categories,this.bp_list,i)),0!=a&&"血氧"==i&&(console.log("获取血氧数据"),this.oxygen_pulse_rate=(a/s).toFixed(0),this.blood_oxygen=this.bo_list[0],n.showLineA(this.chart,this.bo_categories,this.bo_list,i))}},getData:function(e,i){var n=this;return l(a.default.mark((function o(){return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.request({url:"https://ciai.le-cx.com/index.php/api/alarm/getHealthRow",data:{type:e,patient_id:n.pid,start_time:n.start_time,end_time:n.end_time},success:function(e){if(1==e.data.code){var a=e.data.data;0!==a.length?n.drawChart(n.pid,a,i):t.showToast({title:"该时间段内没有数据",icon:"none",duration:3e3})}else t.showToast({title:"请先选择患者",icon:"none",duration:3e3})}});case 2:case"end":return a.stop()}}),o)})))()},bindPickerChange:function(e){this.blood_pressure=null,this.pressure_pulse_rate=null,this.blood_oxygen=null,this.oxygen_pulse_rate=null;var i,n=s(this.patientList);try{for(n.s();!(i=n.n()).done;){var a=i.value;a.id===Number(e.detail.value)+1&&(this.pid=a.id,this.fetchPatientInfo(a.id),t.setStorage({key:"bpid",data:a.id}))}}catch(o){n.e(o)}finally{n.f()}},fetchPatientList:function(){var e=this;return l(a.default.mark((function i(){return a.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.request({url:"https://ciai.le-cx.com/index.php/api/patient/patientList",success:function(t){e.patientList=t.data.data}});case 2:case"end":return i.stop()}}),i)})))()},fetchPatientInfo:function(e){var i=this;return l(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.request({url:"https://ciai.le-cx.com/index.php/api/patient/info?id=".concat(e),success:function(t){i.patient=t.data.data}});case 2:case"end":return n.stop()}}),n)})))()},switchTab:function(t){this.currentIndex=t,this.chart=t+1,this.showCharts=!1},showLineA:function(t,e,i,a){h="血氧"===a||"血糖"===a?new o.default({$this:n,canvasId:t,type:"line",fontSize:11,colors:["#24C789"],legend:{show:!0},dataLabel:!1,dataPointShape:!0,background:"#FFFFFF",pixelRatio:n.pixelRatio,categories:e,series:[{name:a,data:i}],animation:!1,xAxis:{disableGrid:!0,disabled:!0,axisLine:!1},yAxis:{data:[{axisLine:!1,format:function(t){return t.toFixed(0)}}],gridType:"dash",gridColor:"#CCC",dashLength:2},width:n.cWidth*n.pixelRatio,height:n.cHeight*n.pixelRatio,extra:{line:{type:"curve"},tooltip:{gridColor:"#ccc"}}}):new o.default({$this:n,canvasId:t,type:"line",fontSize:11,colors:["#24C789"],legend:{show:!0},dataLabel:!1,dataPointShape:!0,background:"#FFFFFF",pixelRatio:n.pixelRatio,categories:e,series:i,animation:!1,xAxis:{disableGrid:!0,disabled:!0,axisLine:!1},yAxis:{data:[{axisLine:!1,min:0,max:180,format:function(t){return t.toFixed(0)}}],gridType:"dash",gridColor:"#CCC",dashLength:2},width:n.cWidth*n.pixelRatio,height:n.cHeight*n.pixelRatio,extra:{line:{type:"curve"},tooltip:{gridColor:"#ccc"}}})},touchLineA:function(t){h.showToolTip(t,{format:function(e,i){return t.category=i,i+" "+e.name+":"+e.data}}),this.timer=t.category;var e=this.bo_categories.indexOf(this.timer);-1!==e&&(this.high_blood_pressure=this.bp_list[0].data[e],this.low_blood_pressure=this.bp_list[1].data[e])},touchLineB:function(t){h.showToolTip(t,{format:function(e,i){return t.blood_oxygen=e.data,i+" "+e.name+":"+e.data}}),this.blood_oxygen=t.blood_oxygen},dateToTimestamp:function(t){var e=new Date(t).getTime();return e},timestampToTime:function(t){var e=new Date(t),i=e.getFullYear()+"-",n=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",a=(e.getDate()<10?"0"+e.getDate():e.getDate())+" ",o=(e.getHours()<10?"0"+e.getHours():e.getHours())+":",r=(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":",s=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return i+n+a+o+r+s},bindDateChange1:function(t){this.date=t.target.value,this.start_time=this.dateToTimestamp(this.date)},bindDateChange2:function(t){this.date2=t.target.value,this.end_time=this.dateToTimestamp(this.date2)},getDate:function(t){var e=new Date,i=e.getFullYear(),n=e.getMonth()+1,a=e.getDate();return"start"===t?i-=60:"end"===t&&(i+=2),n=n>9?n:"0"+n,a=a>9?a:"0"+a,"".concat(i,"-").concat(n,"-").concat(a)}}};e.default=p}).call(this,i("543d")["default"])},d6df:function(t,e,i){"use strict";i.r(e);var n=i("d660"),a=i.n(n);for(var o in n)"default"!==o&&function(t){i.d(e,t,(function(){return n[t]}))}(o);e["default"]=a.a},e4a1:function(t,e,i){"use strict";var n,a=function(){var t=this,e=t.$createElement,i=(t._self._c,t.date.substr(5)),n=t.date2.substr(5),a=t.date.substr(5),o=t.date2.substr(5),r=t.date.substr(5),s=t.date2.substr(5);t.$mp.data=Object.assign({},{$root:{g0:i,g1:n,g2:a,g3:o,g4:r,g5:s}})},o=[];i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return n}))}},[["c9a0","common/runtime","common/vendor"]]]);